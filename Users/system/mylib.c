#include "config.h"
#include "mylib.h"

/******************************************************************************************************************
                          常 用 函 数 库 

 - 延时函数：
******************************************************************************************************************/
cc Status0, Status1;
const u8 asc_number[] = "0123456789"; ///<0~9的ASCII码表

u8 bcd_number[5];
/*****************************************************************************************************
 - 功能描述：10us的延时函数
 - 隶属模块：常用函数库(内部)
 - 参数说明：无
 - 返回参数：无
 - 注： 在这里的运行环境是51,晶振为12MHZ		
*****************************************************************************************************/
void Delay_Us(u32 z)
{
	while (z--)
		;
}

/***********************毫秒级别延时************************/

void Delay_Ms(u32 z)
{
	u32 x = 0, y = 0;
	for (x = 110; x > 0; x--)
		for (y = z; y > 0; y--)
			;
}

/*****************************************************************************************************
 - 函数说明：获取一个一位十进制的数的个位
 - 隶属模块：内部
 - 参数说明：i:输入的一个一位十进制的数
 - 返回说明：
 - 注      ：
*****************************************************************************************************/
void itoa1(u8 i)
{
	bcd_number[0] = asc_number[i % 10];
	bcd_number[1] = 0;
}

/*****************************************************************************************************
 - 函数说明：获取一个2位十进制的数的各个位
 - 隶属模块：内部
 - 参数说明：i:输入的一个2位十进制的数
 - 返回说明：
 - 注      ：
*****************************************************************************************************/
void itoa2(u8 i)
{
	bcd_number[0] = asc_number[(i % 100) / 10];
	bcd_number[1] = asc_number[(i % 10)];
	bcd_number[2] = 0;
}

/*****************************************************************************************************
 - 函数说明：获取一个3位十进制数的各个位
 - 隶属模块：内部
 - 参数说明：i:输入的一个3位十进制数
 - 返回说明：
 - 注      ：
*****************************************************************************************************/
void itoa3(u16 i)
{
	bcd_number[0] = asc_number[(i % 1000) / 100];
	bcd_number[1] = asc_number[(i % 100) / 10];
	bcd_number[2] = asc_number[i % 10];
	bcd_number[3] = 0;
}

/*****************************************************************************************************
 - 函数说明：获取一个4位十进制的数的各个位
 - 隶属模块：内部
 - 参数说明：i:输入的一个4位十进制的数
 - 返回说明：
 - 注      ：
*****************************************************************************************************/
void itoa4(u16 i)
{
	bcd_number[0] = asc_number[(i % 10000) / 1000];
	bcd_number[1] = asc_number[(i % 1000) / 100];
	bcd_number[2] = asc_number[(i % 100) / 10];
	bcd_number[3] = asc_number[i % 10];
	bcd_number[4] = 0;
}

/*****************************************************************************************************
 - 函数说明：2MS任务的定时处理
 - 隶属模块：内部
 - 参数说明：无
 - 返回说明：
 - 注      ：需要增加任务处理的。往指定位置添加应用函数即可
*****************************************************************************************************/
void DS2MS_CNT(void)
{
	static u8 counter2ms = 0;
	if (1 == System_Flag_2Ms)
	{
		System_Flag_2Ms = 0;
		/*************************************************
             +--------------------+
	      	   2MS定时处理的任务
	         +--------------------+
*************************************************/
		MSG_Task(); //对消息的处理

		if ((++counter2ms) == 5)
		{
			counter2ms = 0;
			System_Flag_10Ms = 1;
		}
	}
}

/*****************************************************************************************************
 - 函数说明：10Ms任务处理
 - 隶属模块：内部
 - 参数说明：无
 - 返回说明：
 - 注      ：需要增加任务处理的。往指定位置添加应用函数即可
*****************************************************************************************************/

void DS10MS_CNT(void)
{
	static u8 counter10ms = 0;
	if (1 == System_Flag_10Ms)
	{
		System_Flag_10Ms = 0;
		/*************************************************
             +--------------------+
	      	   10MS定时处理的任务
	         +--------------------+
*************************************************/
		key_scan();
		UartSend_Collide_Task();
#ifdef UARTREAD
		Uart_communication();
#endif // UARTREAD

		if ((++counter10ms) == 10)
		{
			counter10ms = 0;
			System_Flag_100Ms = 1;
		}
	}
}

/*****************************************************************************************************
 - 函数说明：10Ms任务处理
 - 隶属模块：内部
 - 参数说明：无
 - 返回说明：
 - 注      ：需要增加任务处理的。往指定位置添加应用函数即可
*****************************************************************************************************/

void DS100MS_CNT(void)
{
	static u8 counter100ms = 0;
	if (1 == System_Flag_100Ms)
	{
		System_Flag_100Ms = 0;
		/*************************************************
             +--------------------+
	      	   100MS定时处理的任务
	         +--------------------+
		1、100Ms的定时处理
*************************************************/
		IWDG_ReloadCounter(); //FEED_WDT() ; //喂狗
							  // Indicator_Scan();  //播放指示灯的控制
		Time_Task();
		MP3_HWNextMusic_handle();
		if (++counter100ms == 5)
		{
			counter100ms = 0;
			System_Flag_500Ms = 1;
		}
	}
}

/*****************************************************************************************************
 - 函数说明：500MS任务处理
 - 隶属模块：内部
 - 参数说明：无
 - 返回说明：
 - 注      ：需要增加任务处理的。往指定位置添加应用函数即可
*****************************************************************************************************/

void DS500MS_CNT(void)
{
	if (1 == System_Flag_500Ms)
	{
		System_Flag_500Ms = 0;

		/*************************************************
             +--------------------+
	      	   半秒处理的任务
	         +--------------------+
*************************************************/
	}
}
